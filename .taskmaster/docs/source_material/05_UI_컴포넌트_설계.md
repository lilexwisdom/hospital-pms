# UI 컴포넌트 설계 문서

## 개요

본 문서는 NextJS/Supabase 기반 병원 환자 관리 시스템의 UI 컴포넌트 설계를 상세히 설명합니다. shadcn/ui를 기반으로 하며, 재사용성과 접근성을 고려한 컴포넌트 설계를 제공합니다.

## 디자인 시스템

### 1. 색상 팔레트

```css
/* tailwind.config.ts */
export const colors = {
  primary: {
    50: '#f5f3ff',
    100: '#ede9fe',
    200: '#ddd6fe',
    300: '#c4b5fd',
    400: '#a78bfa',
    500: '#8b5cf6',  // 메인 보라색
    600: '#7c3aed',
    700: '#6d28d9',
    800: '#5b21b6',
    900: '#4c1d95',
  },
  secondary: {
    50: '#eff6ff',
    100: '#dbeafe',
    200: '#bfdbfe',
    300: '#93c5fd',
    400: '#60a5fa',
    500: '#3b82f6',  // 보조 파란색
    600: '#2563eb',
    700: '#1d4ed8',
    800: '#1e40af',
    900: '#1e3a8a',
  },
  success: {
    500: '#10b981',  // 녹색
  },
  warning: {
    500: '#f59e0b',  // 노란색
  },
  error: {
    500: '#ef4444',  // 빨간색
  },
  gray: {
    // Tailwind 기본 gray scale 사용
  }
};
```

### 2. 타이포그래피

```typescript
// styles/typography.ts
export const typography = {
  h1: "text-4xl font-bold tracking-tight",
  h2: "text-3xl font-semibold tracking-tight",
  h3: "text-2xl font-semibold tracking-tight",
  h4: "text-xl font-semibold",
  body: "text-base",
  small: "text-sm",
  caption: "text-xs text-gray-500",
};
```

### 3. 간격 및 레이아웃

```typescript
// styles/spacing.ts
export const spacing = {
  page: "p-6",
  section: "space-y-6",
  card: "p-4 sm:p-6",
  compact: "p-2 sm:p-4",
};
```

## 기본 컴포넌트

### 1. Layout Components

#### MainLayout
```typescript
// components/layouts/MainLayout.tsx
interface MainLayoutProps {
  children: React.ReactNode;
}

export function MainLayout({ children }: MainLayoutProps) {
  const { user } = useAuth();
  const [sidebarOpen, setSidebarOpen] = useState(false);

  return (
    <div className="flex h-screen bg-gray-50">
      {/* Sidebar */}
      <Sidebar 
        open={sidebarOpen} 
        onClose={() => setSidebarOpen(false)}
        user={user}
      />
      
      {/* Main Content */}
      <div className="flex-1 flex flex-col overflow-hidden">
        {/* Header */}
        <Header 
          onMenuClick={() => setSidebarOpen(!sidebarOpen)}
          user={user}
        />
        
        {/* Page Content */}
        <main className="flex-1 overflow-y-auto bg-gray-50">
          <div className="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-8">
            {children}
          </div>
        </main>
      </div>
    </div>
  );
}
```

#### Sidebar
```typescript
// components/layouts/Sidebar.tsx
interface SidebarProps {
  open: boolean;
  onClose: () => void;
  user: User;
}

export function Sidebar({ open, onClose, user }: SidebarProps) {
  const pathname = usePathname();
  
  const navigation = getNavigationItems(user.role);

  return (
    <>
      {/* Mobile sidebar */}
      <Transition.Root show={open} as={Fragment}>
        <Dialog as="div" className="relative z-50 lg:hidden" onClose={onClose}>
          {/* Backdrop */}
          <Transition.Child
            as={Fragment}
            enter="transition-opacity ease-linear duration-300"
            enterFrom="opacity-0"
            enterTo="opacity-100"
            leave="transition-opacity ease-linear duration-300"
            leaveFrom="opacity-100"
            leaveTo="opacity-0"
          >
            <div className="fixed inset-0 bg-gray-900/80" />
          </Transition.Child>

          <div className="fixed inset-0 flex">
            <Transition.Child
              as={Fragment}
              enter="transition ease-in-out duration-300 transform"
              enterFrom="-translate-x-full"
              enterTo="translate-x-0"
              leave="transition ease-in-out duration-300 transform"
              leaveFrom="translate-x-0"
              leaveTo="-translate-x-full"
            >
              <Dialog.Panel className="relative mr-16 flex w-full max-w-xs flex-1">
                <SidebarContent navigation={navigation} pathname={pathname} />
              </Dialog.Panel>
            </Transition.Child>
          </div>
        </Dialog>
      </Transition.Root>

      {/* Desktop sidebar */}
      <div className="hidden lg:fixed lg:inset-y-0 lg:z-50 lg:flex lg:w-72 lg:flex-col">
        <SidebarContent navigation={navigation} pathname={pathname} />
      </div>
    </>
  );
}

function SidebarContent({ navigation, pathname }) {
  return (
    <div className="flex grow flex-col gap-y-5 overflow-y-auto bg-white px-6 pb-4 ring-1 ring-gray-900/10">
      <div className="flex h-16 shrink-0 items-center">
        <Logo />
      </div>
      <nav className="flex flex-1 flex-col">
        <ul role="list" className="flex flex-1 flex-col gap-y-7">
          <li>
            <ul role="list" className="-mx-2 space-y-1">
              {navigation.map((item) => (
                <li key={item.name}>
                  <Link
                    href={item.href}
                    className={cn(
                      pathname === item.href
                        ? 'bg-primary-50 text-primary-600'
                        : 'text-gray-700 hover:text-primary-600 hover:bg-gray-50',
                      'group flex gap-x-3 rounded-md p-2 text-sm leading-6 font-semibold'
                    )}
                  >
                    <item.icon
                      className={cn(
                        pathname === item.href 
                          ? 'text-primary-600' 
                          : 'text-gray-400 group-hover:text-primary-600',
                        'h-6 w-6 shrink-0'
                      )}
                      aria-hidden="true"
                    />
                    {item.name}
                  </Link>
                </li>
              ))}
            </ul>
          </li>
        </ul>
      </nav>
    </div>
  );
}
```

### 2. Data Display Components

#### DataTable
```typescript
// components/ui/data-table.tsx
interface DataTableProps<T> {
  columns: ColumnDef<T>[];
  data: T[];
  loading?: boolean;
  pagination?: {
    page: number;
    pageSize: number;
    total: number;
    onPageChange: (page: number) => void;
  };
  onRowClick?: (row: T) => void;
  emptyMessage?: string;
}

export function DataTable<T>({
  columns,
  data,
  loading = false,
  pagination,
  onRowClick,
  emptyMessage = "데이터가 없습니다",
}: DataTableProps<T>) {
  const table = useReactTable({
    data,
    columns,
    getCoreRowModel: getCoreRowModel(),
    manualPagination: true,
    pageCount: pagination ? Math.ceil(pagination.total / pagination.pageSize) : -1,
  });

  if (loading) {
    return <TableSkeleton columns={columns.length} rows={10} />;
  }

  return (
    <div className="w-full">
      <div className="rounded-md border">
        <Table>
          <TableHeader>
            {table.getHeaderGroups().map((headerGroup) => (
              <TableRow key={headerGroup.id}>
                {headerGroup.headers.map((header) => (
                  <TableHead key={header.id}>
                    {header.isPlaceholder
                      ? null
                      : flexRender(
                          header.column.columnDef.header,
                          header.getContext()
                        )}
                  </TableHead>
                ))}
              </TableRow>
            ))}
          </TableHeader>
          <TableBody>
            {table.getRowModel().rows?.length ? (
              table.getRowModel().rows.map((row) => (
                <TableRow
                  key={row.id}
                  onClick={() => onRowClick?.(row.original)}
                  className={onRowClick ? "cursor-pointer hover:bg-gray-50" : ""}
                >
                  {row.getVisibleCells().map((cell) => (
                    <TableCell key={cell.id}>
                      {flexRender(cell.column.columnDef.cell, cell.getContext())}
                    </TableCell>
                  ))}
                </TableRow>
              ))
            ) : (
              <TableRow>
                <TableCell colSpan={columns.length} className="h-24 text-center">
                  {emptyMessage}
                </TableCell>
              </TableRow>
            )}
          </TableBody>
        </Table>
      </div>
      
      {pagination && (
        <div className="mt-4">
          <DataTablePagination table={table} pagination={pagination} />
        </div>
      )}
    </div>
  );
}
```

#### StatCard
```typescript
// components/ui/stat-card.tsx
interface StatCardProps {
  title: string;
  value: string | number;
  description?: string;
  trend?: {
    value: number;
    isPositive: boolean;
  };
  icon?: React.ElementType;
  loading?: boolean;
}

export function StatCard({
  title,
  value,
  description,
  trend,
  icon: Icon,
  loading = false,
}: StatCardProps) {
  if (loading) {
    return <StatCardSkeleton />;
  }

  return (
    <Card>
      <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
        <CardTitle className="text-sm font-medium">{title}</CardTitle>
        {Icon && <Icon className="h-4 w-4 text-muted-foreground" />}
      </CardHeader>
      <CardContent>
        <div className="text-2xl font-bold">{value}</div>
        {description && (
          <p className="text-xs text-muted-foreground">{description}</p>
        )}
        {trend && (
          <div className="flex items-center pt-1">
            {trend.isPositive ? (
              <ArrowUpIcon className="mr-1 h-3 w-3 text-success-500" />
            ) : (
              <ArrowDownIcon className="mr-1 h-3 w-3 text-error-500" />
            )}
            <span className={cn(
              "text-xs font-medium",
              trend.isPositive ? "text-success-500" : "text-error-500"
            )}>
              {Math.abs(trend.value)}%
            </span>
          </div>
        )}
      </CardContent>
    </Card>
  );
}
```

### 3. Form Components

#### FormField Component
```typescript
// components/forms/FormField.tsx
interface FormFieldProps {
  label: string;
  name: string;
  type?: string;
  placeholder?: string;
  required?: boolean;
  error?: string;
  helpText?: string;
  disabled?: boolean;
}

export function FormField({
  label,
  name,
  type = "text",
  placeholder,
  required = false,
  error,
  helpText,
  disabled = false,
}: FormFieldProps) {
  return (
    <div>
      <Label htmlFor={name} className="flex items-center gap-1">
        {label}
        {required && <span className="text-error-500">*</span>}
      </Label>
      <div className="mt-1">
        <Input
          id={name}
          name={name}
          type={type}
          placeholder={placeholder}
          required={required}
          disabled={disabled}
          className={cn(
            error && "border-error-500 focus:border-error-500 focus:ring-error-500"
          )}
        />
      </div>
      {helpText && !error && (
        <p className="mt-1 text-sm text-gray-500">{helpText}</p>
      )}
      {error && (
        <p className="mt-1 text-sm text-error-500">{error}</p>
      )}
    </div>
  );
}
```

#### PatientForm
```typescript
// components/forms/PatientForm.tsx
interface PatientFormProps {
  onSubmit: (data: PatientFormData) => Promise<void>;
  initialData?: Partial<PatientFormData>;
  mode: 'create' | 'edit';
}

export function PatientForm({ onSubmit, initialData, mode }: PatientFormProps) {
  const form = useForm<PatientFormData>({
    resolver: zodResolver(patientSchema),
    defaultValues: initialData || {
      name: '',
      phone: '',
      ssn: '',
      address: '',
    },
  });

  const [isSubmitting, setIsSubmitting] = useState(false);

  const handleSubmit = async (data: PatientFormData) => {
    setIsSubmitting(true);
    try {
      await onSubmit(data);
      toast.success(
        mode === 'create' 
          ? '환자가 성공적으로 등록되었습니다' 
          : '환자 정보가 수정되었습니다'
      );
    } catch (error) {
      toast.error('오류가 발생했습니다');
    } finally {
      setIsSubmitting(false);
    }
  };

  return (
    <Form {...form}>
      <form onSubmit={form.handleSubmit(handleSubmit)} className="space-y-6">
        <div className="grid grid-cols-1 gap-6 sm:grid-cols-2">
          <FormField
            control={form.control}
            name="name"
            render={({ field }) => (
              <FormItem>
                <FormLabel>환자명 <span className="text-error-500">*</span></FormLabel>
                <FormControl>
                  <Input {...field} />
                </FormControl>
                <FormMessage />
              </FormItem>
            )}
          />

          <FormField
            control={form.control}
            name="phone"
            render={({ field }) => (
              <FormItem>
                <FormLabel>연락처 <span className="text-error-500">*</span></FormLabel>
                <FormControl>
                  <Input 
                    {...field} 
                    placeholder="01012345678"
                    onChange={(e) => {
                      const value = e.target.value.replace(/[^0-9]/g, '');
                      field.onChange(value);
                    }}
                  />
                </FormControl>
                <FormDescription>
                  하이픈(-) 없이 숫자만 입력하세요
                </FormDescription>
                <FormMessage />
              </FormItem>
            )}
          />

          {mode === 'create' && (
            <FormField
              control={form.control}
              name="ssn"
              render={({ field }) => (
                <FormItem>
                  <FormLabel>주민등록번호 <span className="text-error-500">*</span></FormLabel>
                  <FormControl>
                    <Input 
                      {...field}
                      placeholder="800101-1234567"
                      onChange={(e) => {
                        let value = e.target.value.replace(/[^0-9]/g, '');
                        if (value.length > 6) {
                          value = value.slice(0, 6) + '-' + value.slice(6, 13);
                        }
                        field.onChange(value);
                      }}
                    />
                  </FormControl>
                  <FormMessage />
                </FormItem>
              )}
            />
          )}

          <FormField
            control={form.control}
            name="address"
            render={({ field }) => (
              <FormItem className="sm:col-span-2">
                <FormLabel>주소</FormLabel>
                <FormControl>
                  <Textarea {...field} rows={3} />
                </FormControl>
                <FormMessage />
              </FormItem>
            )}
          />
        </div>

        <div className="flex gap-4">
          <Button
            type="submit"
            disabled={isSubmitting}
            className="flex-1 sm:flex-none"
          >
            {isSubmitting && <Loader2 className="mr-2 h-4 w-4 animate-spin" />}
            {mode === 'create' ? '환자 등록' : '정보 수정'}
          </Button>
          <Button
            type="button"
            variant="outline"
            onClick={() => form.reset()}
            disabled={isSubmitting}
          >
            초기화
          </Button>
        </div>
      </form>
    </Form>
  );
}
```

### 4. Feedback Components

#### Toast Notifications
```typescript
// components/ui/toast.tsx
export function Toaster() {
  const { toasts } = useToast();

  return (
    <ToastProvider>
      {toasts.map(function ({ id, title, description, action, ...props }) {
        return (
          <Toast key={id} {...props}>
            <div className="grid gap-1">
              {title && <ToastTitle>{title}</ToastTitle>}
              {description && (
                <ToastDescription>{description}</ToastDescription>
              )}
            </div>
            {action}
            <ToastClose />
          </Toast>
        );
      })}
      <ToastViewport />
    </ToastProvider>
  );
}
```

#### ConfirmDialog
```typescript
// components/ui/confirm-dialog.tsx
interface ConfirmDialogProps {
  open: boolean;
  onOpenChange: (open: boolean) => void;
  title: string;
  description: string;
  confirmText?: string;
  cancelText?: string;
  variant?: 'default' | 'destructive';
  onConfirm: () => void | Promise<void>;
}

export function ConfirmDialog({
  open,
  onOpenChange,
  title,
  description,
  confirmText = '확인',
  cancelText = '취소',
  variant = 'default',
  onConfirm,
}: ConfirmDialogProps) {
  const [isLoading, setIsLoading] = useState(false);

  const handleConfirm = async () => {
    setIsLoading(true);
    try {
      await onConfirm();
      onOpenChange(false);
    } finally {
      setIsLoading(false);
    }
  };

  return (
    <AlertDialog open={open} onOpenChange={onOpenChange}>
      <AlertDialogContent>
        <AlertDialogHeader>
          <AlertDialogTitle>{title}</AlertDialogTitle>
          <AlertDialogDescription>{description}</AlertDialogDescription>
        </AlertDialogHeader>
        <AlertDialogFooter>
          <AlertDialogCancel disabled={isLoading}>
            {cancelText}
          </AlertDialogCancel>
          <AlertDialogAction
            onClick={handleConfirm}
            disabled={isLoading}
            className={variant === 'destructive' ? 'bg-error-500 hover:bg-error-600' : ''}
          >
            {isLoading && <Loader2 className="mr-2 h-4 w-4 animate-spin" />}
            {confirmText}
          </AlertDialogAction>
        </AlertDialogFooter>
      </AlertDialogContent>
    </AlertDialog>
  );
}
```

### 5. Loading & Skeleton Components

#### PageSkeleton
```typescript
// components/ui/page-skeleton.tsx
export function PageSkeleton() {
  return (
    <div className="space-y-6">
      {/* Header Skeleton */}
      <div className="flex items-center justify-between">
        <Skeleton className="h-8 w-48" />
        <Skeleton className="h-10 w-32" />
      </div>

      {/* Stats Skeleton */}
      <div className="grid gap-4 md:grid-cols-2 lg:grid-cols-4">
        {Array.from({ length: 4 }).map((_, i) => (
          <StatCardSkeleton key={i} />
        ))}
      </div>

      {/* Table Skeleton */}
      <Card>
        <CardHeader>
          <Skeleton className="h-6 w-32" />
        </CardHeader>
        <CardContent>
          <TableSkeleton columns={5} rows={5} />
        </CardContent>
      </Card>
    </div>
  );
}

export function TableSkeleton({ columns, rows }: { columns: number; rows: number }) {
  return (
    <div className="w-full">
      <div className="border rounded-md">
        <div className="border-b p-4">
          <div className="flex gap-4">
            {Array.from({ length: columns }).map((_, i) => (
              <Skeleton key={i} className="h-4 flex-1" />
            ))}
          </div>
        </div>
        <div className="p-4 space-y-3">
          {Array.from({ length: rows }).map((_, i) => (
            <div key={i} className="flex gap-4">
              {Array.from({ length: columns }).map((_, j) => (
                <Skeleton key={j} className="h-4 flex-1" />
              ))}
            </div>
          ))}
        </div>
      </div>
    </div>
  );
}
```

## 페이지별 UI 구성

### 1. 대시보드 페이지

```typescript
// app/dashboard/page.tsx
export default function DashboardPage() {
  const { data: stats, isLoading } = useQuery({
    queryKey: ['dashboard-stats'],
    queryFn: fetchDashboardStats,
  });
  const { user } = useAuth();

  if (isLoading) return <PageSkeleton />;

  return (
    <div className="space-y-6">
      <PageHeader
        title="대시보드"
        description="병원 환자 관리 시스템 현황"
      />

      {/* 통계 카드 */}
      <div className="grid gap-4 md:grid-cols-2 lg:grid-cols-4">
        <StatCard
          title="전체 환자"
          value={stats.totalPatients}
          icon={Users}
          trend={{ value: 12, isPositive: true }}
        />
        <StatCard
          title="오늘 예약"
          value={stats.todayAppointments}
          icon={Calendar}
        />
        <StatCard
          title="대기중 환자"
          value={stats.pendingPatients}
          icon={Clock}
        />
        <StatCard
          title="월간 검사 완료"
          value={stats.monthlyCompleted}
          icon={CheckCircle}
          trend={{ value: 8, isPositive: true }}
        />
      </div>

      {/* 대외협력이사 전용 위젯 */}
      {user?.role === 'BD' && (
        <div className="grid gap-6 md:grid-cols-2">
          <RecentSurveySubmissions />
          <MyPatientStatus />
        </div>
      )}

      {/* 차트 영역 */}
      <div className="grid gap-6 md:grid-cols-2">
        <Card>
          <CardHeader>
            <CardTitle>월별 환자 유입 현황</CardTitle>
          </CardHeader>
          <CardContent>
            <PatientTrendChart data={stats.monthlyTrend} />
          </CardContent>
        </Card>

        <Card>
          <CardHeader>
            <CardTitle>검사 항목별 분포</CardTitle>
          </CardHeader>
          <CardContent>
            <ExamDistributionChart data={stats.examDistribution} />
          </CardContent>
        </Card>
      </div>

      {/* 최근 활동 */}
      <Card>
        <CardHeader>
          <CardTitle>최근 활동</CardTitle>
        </CardHeader>
        <CardContent>
          <RecentActivityList activities={stats.recentActivities} />
        </CardContent>
      </Card>
    </div>
  );
}

// components/dashboard/RecentSurveySubmissions.tsx
export function RecentSurveySubmissions() {
  const { data: surveys, isLoading } = useQuery({
    queryKey: ['recent-surveys'],
    queryFn: fetchRecentSurveys,
    refetchInterval: 30000, // 30초마다 자동 갱신
  });

  const router = useRouter();

  return (
    <Card>
      <CardHeader className="flex flex-row items-center justify-between">
        <CardTitle className="text-lg">최근 설문 응답</CardTitle>
        <Badge variant="outline" className="ml-2">
          실시간 <Dot className="h-3 w-3 animate-pulse text-green-500" />
        </Badge>
      </CardHeader>
      <CardContent>
        <div className="space-y-4">
          {isLoading ? (
            <Skeleton className="h-20" />
          ) : surveys?.length === 0 ? (
            <p className="text-sm text-muted-foreground text-center py-4">
              아직 설문 응답이 없습니다
            </p>
          ) : (
            surveys?.map((survey) => (
              <div
                key={survey.id}
                className="flex items-center justify-between p-3 rounded-lg border hover:bg-accent cursor-pointer transition-colors"
                onClick={() => router.push(`/patients/${survey.patient_id}`)}
              >
                <div className="space-y-1">
                  <div className="flex items-center gap-2">
                    <p className="font-medium">{survey.patient_name}</p>
                    <Badge 
                      variant="secondary" 
                      className="text-xs"
                    >
                      {formatDistanceToNow(new Date(survey.submitted_at), { 
                        addSuffix: true,
                        locale: ko 
                      })}
                    </Badge>
                  </div>
                  <p className="text-sm text-muted-foreground">
                    {survey.health_conditions?.join(', ') || '건강정보 없음'}
                  </p>
                </div>
                <Button
                  size="sm"
                  variant="ghost"
                  onClick={(e) => {
                    e.stopPropagation();
                    router.push(`/patients/${survey.patient_id}/consultation`);
                  }}
                >
                  상담 시작
                  <ArrowRight className="ml-1 h-3 w-3" />
                </Button>
              </div>
            ))
          )}
        </div>
        {surveys && surveys.length > 0 && (
          <Button
            variant="link"
            className="w-full mt-4"
            onClick={() => router.push('/surveys')}
          >
            전체 설문 보기
          </Button>
        )}
      </CardContent>
    </Card>
  );
}

// components/dashboard/MyPatientStatus.tsx
export function MyPatientStatus() {
  const { data: stats } = useQuery({
    queryKey: ['my-patient-stats'],
    queryFn: fetchMyPatientStats,
  });

  return (
    <Card>
      <CardHeader>
        <CardTitle className="text-lg">내 환자 현황</CardTitle>
      </CardHeader>
      <CardContent>
        <div className="space-y-4">
          <div className="flex items-center justify-between">
            <span className="text-sm font-medium">신규 설문 접수</span>
            <Badge>{stats?.newSurveys || 0}</Badge>
          </div>
          <div className="flex items-center justify-between">
            <span className="text-sm font-medium">상담 진행중</span>
            <Badge variant="secondary">{stats?.inConsultation || 0}</Badge>
          </div>
          <div className="flex items-center justify-between">
            <span className="text-sm font-medium">CS팀 인계 완료</span>
            <Badge variant="outline">{stats?.handedOver || 0}</Badge>
          </div>
          <div className="flex items-center justify-between">
            <span className="text-sm font-medium">예약 확정</span>
            <Badge variant="default">{stats?.confirmed || 0}</Badge>
          </div>
          <Separator />
          <div className="flex items-center justify-between font-semibold">
            <span className="text-sm">총 관리 환자</span>
            <span className="text-lg">{stats?.total || 0}명</span>
          </div>
        </div>
      </CardContent>
    </Card>
  );
}
```

### 2. 환자 관리 페이지

```typescript
// app/patients/page.tsx
export default function PatientsPage() {
  const [searchParams, setSearchParams] = useSearchParams();
  const { data, isLoading } = useQuery({
    queryKey: ['patients', searchParams.toString()],
    queryFn: () => fetchPatients(searchParams),
  });

  return (
    <div className="space-y-6">
      <PageHeader
        title="환자 관리"
        action={
          <Link href="/patients/new">
            <Button>
              <Plus className="mr-2 h-4 w-4" />
              신규 환자 등록
            </Button>
          </Link>
        }
      />

      {/* 필터 영역 */}
      <Card>
        <CardContent className="pt-6">
          <PatientFilters
            filters={searchParams}
            onFiltersChange={setSearchParams}
          />
        </CardContent>
      </Card>

      {/* 환자 목록 테이블 */}
      <Card>
        <CardContent className="pt-6">
          <DataTable
            columns={patientColumns}
            data={data?.patients || []}
            loading={isLoading}
            pagination={{
              page: parseInt(searchParams.get('page') || '1'),
              pageSize: 20,
              total: data?.total || 0,
              onPageChange: (page) => 
                setSearchParams({ ...searchParams, page: page.toString() }),
            }}
            onRowClick={(patient) => router.push(`/patients/${patient.id}`)}
          />
        </CardContent>
      </Card>
    </div>
  );
}
```

### 3. 환자 상세 페이지

```typescript
// app/patients/[id]/page.tsx
export default function PatientDetailPage({ params }: { params: { id: string } }) {
  const { data: patient, isLoading } = useQuery({
    queryKey: ['patient', params.id],
    queryFn: () => fetchPatientDetail(params.id),
  });

  const [activeTab, setActiveTab] = useState('overview');

  if (isLoading) return <PageSkeleton />;
  if (!patient) return <NotFound />;

  return (
    <div className="space-y-6">
      <PageHeader
        title={patient.name}
        description={`환자번호: ${patient.patient_number}`}
        breadcrumbs={[
          { label: '환자 관리', href: '/patients' },
          { label: patient.name, href: `/patients/${patient.id}` },
        ]}
        action={
          <div className="flex gap-2">
            <Button variant="outline" size="sm">
              <Phone className="mr-2 h-4 w-4" />
              연락하기
            </Button>
            <Button size="sm">
              <MessageSquare className="mr-2 h-4 w-4" />
              상담 기록
            </Button>
          </div>
        }
      />

      {/* 설문 응답 데이터 표시 (설문으로 생성된 환자인 경우) */}
      {patient.survey_response && (
        <SurveyResponseAlert surveyResponse={patient.survey_response} />
      )}

      {/* 환자 정보 요약 카드 */}
      <div className="grid gap-4 md:grid-cols-3">
        <Card>
          <CardHeader className="pb-2">
            <CardTitle className="text-sm font-medium">기본 정보</CardTitle>
          </CardHeader>
          <CardContent>
            <dl className="space-y-2">
              <div className="flex justify-between">
                <dt className="text-sm text-muted-foreground">연락처</dt>
                <dd className="text-sm font-medium">{formatPhoneNumber(patient.phone)}</dd>
              </div>
              <div className="flex justify-between">
                <dt className="text-sm text-muted-foreground">주소</dt>
                <dd className="text-sm font-medium truncate">{patient.address || '-'}</dd>
              </div>
              <div className="flex justify-between">
                <dt className="text-sm text-muted-foreground">등록일</dt>
                <dd className="text-sm font-medium">
                  {format(new Date(patient.created_at), 'yyyy-MM-dd')}
                </dd>
              </div>
            </dl>
          </CardContent>
        </Card>

        <Card>
          <CardHeader className="pb-2">
            <CardTitle className="text-sm font-medium">건강 정보</CardTitle>
          </CardHeader>
          <CardContent>
            <div className="flex flex-wrap gap-1">
              {patient.has_hypertension && <Badge variant="secondary">고혈압</Badge>}
              {patient.has_diabetes && <Badge variant="secondary">당뇨</Badge>}
              {patient.has_hyperlipidemia && <Badge variant="secondary">고지혈증</Badge>}
              {patient.has_anticoagulant && <Badge variant="secondary">항응고제</Badge>}
              {patient.has_asthma && <Badge variant="secondary">천식</Badge>}
              {patient.has_allergy && <Badge variant="secondary">알러지</Badge>}
              {patient.has_brain_heart_disease && <Badge variant="secondary">뇌심장질환</Badge>}
              {patient.has_pregnancy_possibility && <Badge variant="secondary">임신가능성</Badge>}
              {!hasAnyHealthCondition(patient) && (
                <span className="text-sm text-muted-foreground">특이사항 없음</span>
              )}
            </div>
          </CardContent>
        </Card>

        <Card>
          <CardHeader className="pb-2">
            <CardTitle className="text-sm font-medium">진행 상태</CardTitle>
          </CardHeader>
          <CardContent>
            <div className="space-y-3">
              <PatientStatusBadge status={patient.status} size="lg" />
              <div className="flex justify-between text-sm">
                <span className="text-muted-foreground">담당자</span>
                <span className="font-medium">
                  {patient.assigned_bd_name || patient.assigned_cs_name || '-'}
                </span>
              </div>
              {patient.next_appointment_date && (
                <div className="flex justify-between text-sm">
                  <span className="text-muted-foreground">다음 예약</span>
                  <span className="font-medium">
                    {format(new Date(patient.next_appointment_date), 'MM/dd')}
                  </span>
                </div>
              )}
            </div>
          </CardContent>
        </Card>
      </div>

      {/* 탭 네비게이션 */}
      <Tabs value={activeTab} onValueChange={setActiveTab}>
        <TabsList>
          <TabsTrigger value="overview">개요</TabsTrigger>
          <TabsTrigger value="medical">의료 정보</TabsTrigger>
          <TabsTrigger value="consultations">상담 이력</TabsTrigger>
          <TabsTrigger value="appointments">예약 정보</TabsTrigger>
        </TabsList>

        <TabsContent value="overview" className="space-y-4">
          <PatientOverviewTab patient={patient} />
        </TabsContent>

        <TabsContent value="medical" className="space-y-4">
          <PatientMedicalTab patientId={patient.id} />
        </TabsContent>

        <TabsContent value="consultations" className="space-y-4">
          <PatientConsultationTab patientId={patient.id} />
        </TabsContent>

        <TabsContent value="appointments" className="space-y-4">
          <PatientAppointmentTab patientId={patient.id} />
        </TabsContent>
      </Tabs>
    </div>
  );
}

// components/patients/SurveyResponseAlert.tsx
interface SurveyResponseAlertProps {
  surveyResponse: SurveyResponse;
}

export function SurveyResponseAlert({ surveyResponse }: SurveyResponseAlertProps) {
  const [isExpanded, setIsExpanded] = useState(true);

  return (
    <Alert className="border-primary-500/20 bg-primary-50/50">
      <InfoIcon className="h-4 w-4 text-primary-600" />
      <AlertTitle className="flex items-center justify-between">
        <span>설문 응답 정보</span>
        <Button
          variant="ghost"
          size="sm"
          onClick={() => setIsExpanded(!isExpanded)}
        >
          {isExpanded ? <ChevronUp /> : <ChevronDown />}
        </Button>
      </AlertTitle>
      {isExpanded && (
        <AlertDescription>
          <div className="mt-4 space-y-3">
            <div>
              <p className="font-medium text-sm mb-1">제출 시간</p>
              <p className="text-sm text-muted-foreground">
                {format(new Date(surveyResponse.submitted_at), 'yyyy년 MM월 dd일 HH:mm')}
              </p>
            </div>
            
            {surveyResponse.desired_exams && (
              <div>
                <p className="font-medium text-sm mb-1">희망 검사</p>
                <div className="flex flex-wrap gap-1 mt-1">
                  {surveyResponse.desired_exams.map((exam) => (
                    <Badge key={exam} variant="outline">{exam}</Badge>
                  ))}
                </div>
              </div>
            )}

            {surveyResponse.additional_medical_info && (
              <div>
                <p className="font-medium text-sm mb-1">추가 의료 정보</p>
                <p className="text-sm text-muted-foreground whitespace-pre-wrap">
                  {surveyResponse.additional_medical_info}
                </p>
              </div>
            )}

            {surveyResponse.current_medications && (
              <div>
                <p className="font-medium text-sm mb-1">복용 중인 약물</p>
                <p className="text-sm text-muted-foreground whitespace-pre-wrap">
                  {surveyResponse.current_medications}
                </p>
              </div>
            )}

            <div className="pt-2">
              <Button
                variant="outline"
                size="sm"
                className="w-full"
                onClick={() => window.print()}
              >
                <Printer className="mr-2 h-4 w-4" />
                설문 응답 인쇄
              </Button>
            </div>
          </div>
        </AlertDescription>
      )}
    </Alert>
  );
}

// components/patients/PatientOverviewTab.tsx
export function PatientOverviewTab({ patient }: { patient: Patient }) {
  return (
    <div className="grid gap-6 md:grid-cols-2">
      {/* 최근 상담 요약 */}
      <Card>
        <CardHeader>
          <CardTitle className="text-base">최근 상담 요약</CardTitle>
        </CardHeader>
        <CardContent>
          {patient.latest_consultation ? (
            <div className="space-y-2">
              <p className="text-sm text-muted-foreground">
                {formatDistanceToNow(new Date(patient.latest_consultation.date), {
                  addSuffix: true,
                  locale: ko,
                })}
              </p>
              <p className="text-sm">{patient.latest_consultation.summary}</p>
              <Button variant="link" size="sm" className="p-0">
                전체 보기 →
              </Button>
            </div>
          ) : (
            <p className="text-sm text-muted-foreground">아직 상담 기록이 없습니다</p>
          )}
        </CardContent>
      </Card>

      {/* 빠른 작업 */}
      <Card>
        <CardHeader>
          <CardTitle className="text-base">빠른 작업</CardTitle>
        </CardHeader>
        <CardContent>
          <div className="grid grid-cols-2 gap-2">
            <Button variant="outline" size="sm">
              <Plus className="mr-2 h-4 w-4" />
              상담 기록
            </Button>
            <Button variant="outline" size="sm">
              <Calendar className="mr-2 h-4 w-4" />
              예약 생성
            </Button>
            <Button variant="outline" size="sm">
              <Edit className="mr-2 h-4 w-4" />
              정보 수정
            </Button>
            <Button variant="outline" size="sm">
              <UserPlus className="mr-2 h-4 w-4" />
              CS 인계
            </Button>
          </div>
        </CardContent>
      </Card>
    </div>
  );
}
```

### 4. 환자 설문 페이지

```typescript
// app/survey/[token]/page.tsx
export default function SurveyPage({ params }: { params: { token: string } }) {
  const [step, setStep] = useState(1);
  const [isSubmitting, setIsSubmitting] = useState(false);
  const form = useForm<SurveyFormData>({
    resolver: zodResolver(surveySchema),
  });

  const handleSubmit = async (data: SurveyFormData) => {
    setIsSubmitting(true);
    try {
      await submitSurvey(params.token, data);
      setStep(4); // 완료 단계
    } catch (error) {
      toast.error('설문 제출 중 오류가 발생했습니다');
    } finally {
      setIsSubmitting(false);
    }
  };

  return (
    <div className="min-h-screen bg-gradient-to-br from-primary-50 to-secondary-50">
      <div className="mx-auto max-w-2xl px-4 py-16 sm:px-6 lg:px-8">
        <Card className="shadow-xl">
          <CardHeader className="text-center">
            <CardTitle className="text-2xl">진료 예약을 위한 사전 설문</CardTitle>
            <CardDescription>
              정확한 상담을 위해 아래 정보를 입력해주세요
            </CardDescription>
          </CardHeader>
          <CardContent>
            {/* Progress Steps */}
            <SurveyProgress currentStep={step} totalSteps={3} />

            <Form {...form}>
              <form onSubmit={form.handleSubmit(handleSubmit)} className="mt-8 space-y-6">
                {step === 1 && <PersonalInfoStep form={form} />}
                {step === 2 && <MedicalInfoStep form={form} />}
                {step === 3 && <ExamSelectionStep form={form} />}
                {step === 4 && <CompletionStep />}

                {step < 4 && (
                  <div className="flex gap-4">
                    {step > 1 && (
                      <Button
                        type="button"
                        variant="outline"
                        onClick={() => setStep(step - 1)}
                        disabled={isSubmitting}
                      >
                        이전
                      </Button>
                    )}
                    {step < 3 ? (
                      <Button
                        type="button"
                        onClick={() => {
                          const isValid = validateStep(step, form);
                          if (isValid) setStep(step + 1);
                        }}
                        className="flex-1"
                      >
                        다음
                      </Button>
                    ) : (
                      <Button
                        type="submit"
                        disabled={isSubmitting}
                        className="flex-1"
                      >
                        {isSubmitting && <Loader2 className="mr-2 h-4 w-4 animate-spin" />}
                        설문 제출하기
                      </Button>
                    )}
                  </div>
                )}
              </form>
            </Form>
          </CardContent>
        </Card>
      </div>
    </div>
  );
}
```

#### MedicalInfoStep 컴포넌트
```typescript
// components/survey/MedicalInfoStep.tsx
interface MedicalInfoStepProps {
  form: UseFormReturn<SurveyFormData>;
}

export function MedicalInfoStep({ form }: MedicalInfoStepProps) {
  const healthConditions = form.watch('healthConditions') || [];

  const healthOptions = [
    '고혈압',
    '당뇨',
    '고지혈증',
    '항응고제/항혈소판제 복용 (아스피린, 와파린 등)',
    '천식',
    '특정 약물/음식 알러지',
    '뇌/심장 질환 (뇌졸중, 협심증, 심근경색 등)',
    '임신 가능성 (여성)',
    '위에 해당하는 사항 없음'
  ];

  const handleHealthConditionChange = (condition: string, checked: boolean) => {
    const currentConditions = form.getValues('healthConditions') || [];

    if (condition === '위에 해당하는 사항 없음') {
      // "해당사항 없음" 선택 시 다른 모든 항목 해제
      form.setValue('healthConditions', checked ? [condition] : []);
    } else {
      // 다른 항목 선택 시 "해당사항 없음" 해제
      const filtered = currentConditions.filter(c => c !== '위에 해당하는 사항 없음');
      
      if (checked) {
        form.setValue('healthConditions', [...filtered, condition]);
      } else {
        form.setValue('healthConditions', filtered.filter(c => c !== condition));
      }
    }
  };

  return (
    <div className="space-y-6">
      <div>
        <h3 className="text-lg font-semibold mb-1">[ 질문 3 ] 건강 정보 확인</h3>
        <p className="text-sm text-gray-600 mb-4">
          아래 항목 중 해당하시는 것이 있다면 모두 선택해주세요. (필수)
        </p>

        <FormField
          control={form.control}
          name="healthConditions"
          render={() => (
            <FormItem>
              <div className="space-y-3">
                {healthOptions.map((option) => (
                  <div key={option} className="flex items-start">
                    <FormControl>
                      <Checkbox
                        checked={healthConditions.includes(option)}
                        onCheckedChange={(checked) =>
                          handleHealthConditionChange(option, checked as boolean)
                        }
                        className="mt-1"
                      />
                    </FormControl>
                    <Label
                      className="ml-3 font-normal cursor-pointer"
                      onClick={() => 
                        handleHealthConditionChange(option, !healthConditions.includes(option))
                      }
                    >
                      {option}
                    </Label>
                  </div>
                ))}
              </div>
              <FormMessage />
            </FormItem>
          )}
        />
      </div>

      <FormField
        control={form.control}
        name="additionalMedicalInfo"
        render={({ field }) => (
          <FormItem>
            <FormLabel>
              위에서 선택하신 이외의 앓고 계신 질환, 과거 수술 이력, 가족력에 대해 자세히 적어주세요.
            </FormLabel>
            <FormControl>
              <Textarea
                {...field}
                rows={4}
                placeholder="예: 위궤양으로 수술 받은 적 있음, 가족 중 암 환자 있음 등"
              />
            </FormControl>
          </FormItem>
        )}
      />

      <FormField
        control={form.control}
        name="currentMedications"
        render={({ field }) => (
          <FormItem>
            <FormLabel>
              현재 복용 중인 약물이 있다면 약 이름을 모두 적어주세요.
            </FormLabel>
            <FormControl>
              <Textarea
                {...field}
                rows={3}
                placeholder="복용 중인 약물명을 적어주세요"
              />
            </FormControl>
          </FormItem>
        )}
      />
    </div>
  );
}
```

## 모바일 대응

### 1. 반응형 그리드
```typescript
// Tailwind 반응형 클래스 사용
<div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4">
  {/* 컨텐츠 */}
</div>
```

### 2. 모바일 네비게이션
```typescript
// components/mobile/MobileNav.tsx
export function MobileNav() {
  const pathname = usePathname();
  const navItems = [
    { href: '/dashboard', icon: Home, label: '홈' },
    { href: '/patients', icon: Users, label: '환자' },
    { href: '/appointments', icon: Calendar, label: '예약' },
    { href: '/profile', icon: User, label: '프로필' },
  ];

  return (
    <nav className="fixed bottom-0 left-0 right-0 z-50 bg-white border-t lg:hidden">
      <div className="grid grid-cols-4">
        {navItems.map((item) => (
          <Link
            key={item.href}
            href={item.href}
            className={cn(
              "flex flex-col items-center justify-center py-2 text-xs",
              pathname === item.href
                ? "text-primary-600"
                : "text-gray-600"
            )}
          >
            <item.icon className="h-5 w-5 mb-1" />
            {item.label}
          </Link>
        ))}
      </div>
    </nav>
  );
}
```

## 접근성 고려사항

### 1. ARIA Labels
```typescript
<Button aria-label="새 환자 등록">
  <Plus className="h-4 w-4" />
  <span className="sr-only">새 환자 등록</span>
</Button>
```

### 2. 키보드 네비게이션
```typescript
// 키보드 단축키 구현
useEffect(() => {
  const handleKeyPress = (e: KeyboardEvent) => {
    if (e.metaKey || e.ctrlKey) {
      switch (e.key) {
        case 'k':
          e.preventDefault();
          openSearchModal();
          break;
        case 'n':
          e.preventDefault();
          router.push('/patients/new');
          break;
      }
    }
  };

  document.addEventListener('keydown', handleKeyPress);
  return () => document.removeEventListener('keydown', handleKeyPress);
}, []);
```

### 3. 포커스 관리
```typescript
// 모달 오픈 시 포커스 관리
useEffect(() => {
  if (open) {
    const firstInput = dialogRef.current?.querySelector('input');
    firstInput?.focus();
  }
}, [open]);
```

## 성능 최적화

### 1. 지연 로딩
```typescript
// 동적 임포트
const PatientDetailModal = dynamic(
  () => import('@/components/modals/PatientDetailModal'),
  { loading: () => <Spinner /> }
);
```

### 2. 메모이제이션
```typescript
// 무거운 연산 메모이제이션
const filteredPatients = useMemo(() => {
  return patients.filter(patient => {
    // 복잡한 필터링 로직
  });
}, [patients, filters]);
```

### 3. 가상화
```typescript
// 대량 데이터 리스트 가상화
import { VirtualList } from '@tanstack/react-virtual';

export function LargePatientList({ patients }) {
  const parentRef = useRef<HTMLDivElement>(null);

  const virtualizer = useVirtualizer({
    count: patients.length,
    getScrollElement: () => parentRef.current,
    estimateSize: () => 80,
  });

  return (
    <div ref={parentRef} className="h-[600px] overflow-auto">
      <div
        style={{
          height: `${virtualizer.getTotalSize()}px`,
          width: '100%',
          position: 'relative',
        }}
      >
        {virtualizer.getVirtualItems().map((virtualItem) => (
          <PatientRow
            key={virtualItem.key}
            patient={patients[virtualItem.index]}
            style={{
              position: 'absolute',
              top: 0,
              left: 0,
              width: '100%',
              height: `${virtualItem.size}px`,
              transform: `translateY(${virtualItem.start}px)`,
            }}
          />
        ))}
      </div>
    </div>
  );
}
```

## Storybook 설정

```typescript
// stories/Button.stories.tsx
import type { Meta, StoryObj } from '@storybook/react';
import { Button } from '@/components/ui/button';

const meta = {
  title: 'UI/Button',
  component: Button,
  parameters: {
    layout: 'centered',
  },
  tags: ['autodocs'],
  argTypes: {
    variant: {
      control: 'select',
      options: ['default', 'destructive', 'outline', 'secondary', 'ghost', 'link'],
    },
    size: {
      control: 'select',
      options: ['default', 'sm', 'lg', 'icon'],
    },
  },
} satisfies Meta<typeof Button>;

export default meta;
type Story = StoryObj<typeof meta>;

export const Default: Story = {
  args: {
    children: 'Button',
  },
};

export const AllVariants: Story = {
  render: () => (
    <div className="flex gap-4">
      <Button>Default</Button>
      <Button variant="secondary">Secondary</Button>
      <Button variant="destructive">Destructive</Button>
      <Button variant="outline">Outline</Button>
      <Button variant="ghost">Ghost</Button>
      <Button variant="link">Link</Button>
    </div>
  ),
};
```

---

본 문서는 병원 환자 관리 시스템의 UI 컴포넌트 설계를 상세히 설명합니다. 모든 컴포넌트는 재사용성, 접근성, 성능을 고려하여 설계되었습니다.