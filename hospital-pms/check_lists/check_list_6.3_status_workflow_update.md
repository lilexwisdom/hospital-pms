# 환자 상태 워크플로우 재설계 검증 체크리스트

## 1. 데이터베이스 마이그레이션

- [v] Supabase SQL Editor에서 다음 마이그레이션 실행:
  ```sql
  -- /supabase/migrations/20250728_update_patient_status_to_new_workflow.sql 내용 실행
  ```

## 2. 상태 전환 테스트

### BD 역할 테스트

- [ ] BD 계정으로 로그인
- [ ] 대기중(pending) → 활성(active) 전환 가능 확인
- [ ] 활성(active) → 상담완료(consulted) 전환 가능 확인
- [ ] 상담완료 이후 상태는 변경 불가능 확인

### CS 역할 테스트

- [v] CS 계정으로 로그인
- [v] 상담완료(consulted) → 예약상담중(reservation_in_progress) 전환 가능 확인
- [v] 예약상담중 → 예약완료 → 검사중 → 검사완료 → 검사결과 대기 → 종결 순차 전환 확인
- [v] CS 담당자 자동 배정 확인 (consulted → reservation_in_progress 전환 시)

### Manager/Admin 역할 테스트

- [v] 모든 상태에서 종결(closed)로 직접 전환 가능 확인
- [v] 종결(closed) → 대기중(pending) 재활성화 가능 확인
- [v] 필수 메모 입력 확인

## 3. UI 표시 확인

- [ ] 환자 목록에서 새로운 9개 상태 모두 올바르게 표시
- [ ] 각 상태별 색상과 라벨 확인:
  - 대기중 (secondary)
  - 활성 (default)
  - 상담완료 (primary)
  - 예약상담중 (info)
  - 예약완료 (success)
  - 검사중 (warning)
  - 검사완료 (success)
  - 검사결과 대기 (info)
  - 종결 (muted)

## 4. 상태 이력 추적

- [v] 모든 상태 변경이 patient_status_history 테이블에 기록
- [v] 변경자, 변경 시간, 메모 저장 확인
- [v] 상태 이력 탭에서 전체 이력 조회 가능

## 5. 권한 검증

- [ ] BD는 예약상담중 이후 상태 변경 불가
- [v] CS는 대기중, 활성 상태 변경 불가
- [v] 필수 메모가 있는 전환에서 메모 없이 변경 시도 시 에러 표시

## 6. 기존 데이터 마이그레이션

- [v] 기존 inactive, discharged 등의 상태가 closed로 변환되었는지 확인

## 테스트 시나리오

### 시나리오 1: 정상 플로우

1. 환자 등록 (대기중)
2. BD 문진 시작 (대기중 → 활성)
3. BD 상담 완료 (활성 → 상담완료)
4. CS 예약 상담 시작 (상담완료 → 예약상담중)
5. 예약 확정 (예약상담중 → 예약완료)
6. 검사 당일 (예약완료 → 검사중)
7. 검사 종료 (검사중 → 검사완료)
8. 결과 대기 (검사완료 → 검사결과 대기)
9. 프로세스 종료 (검사결과 대기 → 종결)

### 시나리오 2: 예외 처리

1. Manager가 중간에 종결 처리
2. 종결된 환자 재활성화
3. 권한 없는 상태 변경 시도

## 완료 확인

- [ ] 모든 테스트 통과
- [ ] 사용자 피드백 수집
- [ ] 문제 발생 시 수정사항 기록
